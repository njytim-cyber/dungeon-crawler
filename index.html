<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Dungeon Crawler RPG</title>
  <meta name="description"
    content="A 2D top-down dungeon crawler RPG with 100 floors, 9 character classes, and procedurally generated dungeons.">
  <meta name="theme-color" content="#0f0f23">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>
  <canvas id="gameCanvas"></canvas>

  <!-- Floor Transition Overlay -->
  <div id="floor-transition" class="hidden">
    <div id="floor-transition-text">Floor 1</div>
  </div>

  <!-- Damage Flash Overlay -->
  <div id="damage-flash" class="hidden"></div>

  <!-- Fishing Minigame Overlay -->
  <div id="fishing-overlay" class="hidden">
    <div id="fishing-box">
      <div id="fishing-title">ğŸ£ Fishing!</div>
      <div id="fishing-instruction">Press E or tap CATCH when the marker hits the green zone!</div>
      <div id="fishing-bar">
        <div id="fishing-sweetspot"></div>
        <div id="fishing-marker"></div>
      </div>
      <button id="fishing-catch-btn">ğŸ£ CATCH!</button>
      <div id="fishing-result"></div>
    </div>
  </div>

  <!-- Forge Overlay -->
  <div id="forge-overlay" class="hidden">
    <div id="forge-box">
      <div id="forge-header">
        <h2>âš’ï¸ THE FORGE</h2>
        <button id="forge-close-btn">âœ•</button>
      </div>
      <div id="forge-instruction">Select 2 weapons to combine into one mighty weapon!</div>
      <div id="forge-selection">
        <div id="forge-sel1-label" class="forge-sel-label">Select weapon 1</div>
        <div class="forge-plus">+</div>
        <div id="forge-sel2-label" class="forge-sel-label">Select weapon 2</div>
        <div class="forge-equals">=</div>
        <div class="forge-result-label">?</div>
      </div>
      <div id="forge-weapon-grid"></div>
      <div id="forge-preview"></div>
      <div id="forge-result-stats"></div>
      <button id="forge-confirm-btn" class="hidden">ğŸ”¥ FORGE!</button>
    </div>
  </div>

  <!-- HUD Overlay -->
  <div id="hud" class="hidden">
    <div id="hud-top">
      <div id="hud-stats">
        <div id="health-bar-container">
          <div id="health-bar"></div>
          <span id="health-text">100/100</span>
        </div>
        <div id="xp-bar-container">
          <div id="xp-bar"></div>
          <span id="xp-text">XP: 0/100</span>
        </div>
        <div id="hud-info-row">
          <span id="level-text">Lv. 1</span>
          <span id="floor-text">Floor 1</span>
          <span id="gold-text">ğŸ’° 0</span>
          <span id="time-text" style="color: #f39c12; margin-left: 8px;">08:00</span>
        </div>
      </div>
      <div id="minimap-container">
        <canvas id="minimapCanvas" width="140" height="140"></canvas>
      </div>
    </div>
    <div id="hotbar">
      <div class="hotbar-slot" data-slot="0"><span class="hotbar-key">1</span></div>
      <div class="hotbar-slot" data-slot="1"><span class="hotbar-key">2</span></div>
      <div class="hotbar-slot" data-slot="2"><span class="hotbar-key">3</span></div>
      <div class="hotbar-slot" data-slot="3"><span class="hotbar-key">4</span></div>
      <div class="hotbar-slot" data-slot="4"><span class="hotbar-key">5</span></div>
    </div>
    <div id="message-log"></div>
    <button id="inventory-btn" title="Inventory (I)">ğŸ’</button>
    <button id="save-btn" title="Save Game">ğŸ’¾</button>
    <button id="settings-ingame-btn" title="Settings (Esc)">âš™ï¸</button>
    <div id="systems-buttons">
      <button class="sys-btn" data-panel="bestiary" title="Bestiary (B)">ğŸ“–</button>
      <button class="sys-btn" data-panel="achievements" title="Achievements">ğŸ†</button>
      <button class="sys-btn" data-panel="skills" title="Skills (K)">ğŸŒŸ</button>
      <button class="sys-btn" data-panel="quests" title="Quests (J)">ğŸ“‹</button>
      <button class="sys-btn" data-panel="museum" title="Museum">ğŸ›ï¸</button>
      <button class="sys-btn" data-panel="hearts" title="Relationships">â¤ï¸</button>
    </div>
  </div>

  <!-- Systems Overlay (Bestiary, Skills, etc) -->
  <div id="systems-overlay" class="hidden">
    <div id="systems-panel">
      <div id="systems-header">
        <h2 id="systems-title">Systems</h2>
        <button id="systems-close">âœ•</button>
      </div>
      <div id="systems-content"></div>
    </div>
  </div>

  <!-- Inventory Panel -->
  <div id="inventory-panel" class="hidden">
    <div id="inventory-header">
      <h2>Inventory</h2>
      <button id="close-inventory">âœ•</button>
    </div>
    <div id="equipment-section">
      <h3>Equipment</h3>
      <div id="equipment-slots">
        <div class="equip-slot" data-slot="weapon"><span class="equip-label">Weapon</span></div>
        <div class="equip-slot" data-slot="armor"><span class="equip-label">Armor</span></div>
        <div class="equip-slot" data-slot="ring"><span class="equip-label">Ring</span></div>
      </div>
    </div>
    <div id="player-stats-panel">
      <h3>Stats</h3>
      <div id="stats-display"></div>
    </div>
    <div id="inventory-grid-section">
      <h3>Items</h3>
      <div id="inventory-grid"></div>
    </div>
    <div id="item-tooltip" class="hidden"></div>
  </div>

  <!-- NPC Dialog -->
  <div id="npc-dialog" class="hidden">
    <div id="npc-dialog-box">
      <div id="npc-name"></div>
      <div id="npc-text"></div>
      <div id="npc-options"></div>
    </div>
  </div>

  <!-- Settings Panel -->
  <div id="settings-panel" class="hidden">
    <div id="settings-content">
      <h2 id="settings-title">âš™ï¸ Settings</h2>
      <div class="settings-group">
        <label class="settings-label" data-i18n="lang">Language</label>
        <div class="settings-row">
          <button class="lang-btn" data-lang="en">English</button>
          <button class="lang-btn" data-lang="zh">ä¸­æ–‡</button>
        </div>
      </div>
      <div class="settings-group">
        <label class="settings-label" data-i18n="sfx">Sound Effects</label>
        <div class="settings-row">
          <input type="range" id="sfx-volume" min="0" max="100" value="70">
          <span id="sfx-value">70%</span>
        </div>
      </div>
      <div class="settings-group">
        <label class="settings-label" data-i18n="music">Music</label>
        <div class="settings-row">
          <input type="range" id="music-volume" min="0" max="100" value="50">
          <span id="music-value">50%</span>
        </div>
      </div>
      <div class="settings-group">
        <label class="settings-label" data-i18n="controls">Controls</label>
        <div class="settings-row">
          <button id="ctrl-joystick" class="ctrl-btn active">Joystick</button>
          <button id="ctrl-dpad" class="ctrl-btn">D-Pad</button>
        </div>
      </div>
      <div class="settings-actions">
        <button id="show-tutorial-btn" data-i18n="tutorial_btn">ğŸ“– Tutorial</button>
        <button id="return-hub-btn" class="hidden" data-i18n="hub_btn">ğŸ  Return to Hub</button>
        <button id="close-settings" data-i18n="close">Close</button>
      </div>
      <p id="settings-version" style="font-size: 8px; color: #555; text-align: center; margin-top: 12px;"></p>
    </div>
  </div>

  <!-- Tutorial Overlay -->
  <div id="tutorial-overlay" class="hidden">
    <div id="tutorial-content">
      <div id="tutorial-slide">
        <h2 id="tutorial-heading">Welcome, Adventurer!</h2>
        <p id="tutorial-text">Use WASD or the joystick to move. Click or press Space to attack.</p>
      </div>
      <div id="tutorial-dots"></div>
      <div id="tutorial-actions">
        <button id="tutorial-prev" class="hidden">â—€ Back</button>
        <button id="tutorial-next">Next â–¶</button>
      </div>
    </div>
  </div>

  <!-- Title Screen -->
  <div id="title-screen">
    <div id="title-content">
      <h1 id="game-title">âš”ï¸ DUNGEON CRAWLER</h1>
      <p id="game-subtitle">Descend into the depths...</p>
      <p id="title-version" style="font-size: 8px; color: #555; margin-top: 4px;"></p>

      <div id="main-menu">
        <button id="continue-btn" class="hidden">Continue (Floor <span id="save-floor">1</span>)</button>
        <button id="new-game-btn">New Game</button>
        <button id="title-settings-btn">âš™ï¸ Settings</button>
      </div>

      <div id="class-select" class="hidden">
        <h2>Choose Your Class</h2>
        <div id="name-input-container" style="text-align: center; margin-bottom: 1rem;">
          <input type="text" id="player-name-input" placeholder="Enter Name" maxlength="12"
            style="padding: 8px; font-family: 'Press Start 2P'; font-size: 12px; width: 200px; text-align: center;">
        </div>
        <div id="class-grid"></div>
        <div id="class-description">Select a class to see details</div>
        <div id="class-actions">
          <button id="start-run-btn" class="hidden" disabled>Begin Adventure</button>
          <button id="back-to-menu-btn">Back</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Over Screen -->
  <div id="gameover-screen" class="hidden">
    <div id="gameover-content">
      <h1>ğŸ’€ YOU DIED</h1>
      <div id="death-stats"></div>
      <button id="retry-btn">Try Again</button>
    </div>
  </div>

  <!-- Victory Screen -->
  <div id="victory-screen" class="hidden">
    <div id="victory-content">
      <h1>ğŸ† VICTORY!</h1>
      <p>You conquered all 100 floors!</p>
      <div id="victory-stats"></div>
      <button id="victory-retry-btn">Play Again</button>
    </div>
  </div>

  <!-- Mobile Controls -->
  <div id="mobile-controls" class="hidden">
    <!-- Joystick (default) -->
    <div id="joystick-area">
      <div id="joystick-base">
        <div id="joystick-knob"></div>
      </div>
    </div>
    <!-- D-Pad (toggle) -->
    <div id="dpad" class="hidden">
      <button class="dpad-btn" data-dir="up">â–²</button>
      <button class="dpad-btn" data-dir="left">â—€</button>
      <button class="dpad-btn" data-dir="right">â–¶</button>
      <button class="dpad-btn" data-dir="down">â–¼</button>
    </div>
    <div id="action-buttons">
      <button id="mobile-attack" class="action-btn">âš”ï¸</button>
      <button id="mobile-interact" class="action-btn">ğŸ’¬</button>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => console.log('SW registered: ', registration))
          .catch(registrationError => console.log('SW registration failed: ', registrationError));
      });
    }
  </script>
</body>

</html>